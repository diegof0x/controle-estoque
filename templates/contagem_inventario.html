{% extends "layout_base.html" %}

{% block title %}Contagem de Inventário{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Contagem do Inventário #{{ inventario.id }} - {{ inventario.descricao if inventario.descricao else '' }}</h1>
    <div>
        <a href="{{ url_for('exportar_contagem_inventario_csv', inventario_id=inventario.id) }}" class="btn btn-secondary">
            <i class="bi bi-printer"></i> Exportar para Contagem
        </a>
        <a href="{{ url_for('pagina_revisar_inventario', inventario_id=inventario.id) }}" class="btn btn-success">
            <i class="bi bi-check-circle"></i> Revisar e Finalizar
        </a>
    </div>
</div>

<form action="{{ url_for('salvar_contagem_inventario') }}" method="post">
    <input type="hidden" name="inventario_id" value="{{ inventario.id }}">

    <div class="table-responsive">
        <table class="table table-striped table-hover">
            <thead>
                <tr>
                    <th>ID Produto</th>
                    <th>Cód. Sustentare</th>
                    <th>Cód. Valor</th>
                    <th>Descrição</th>
                    <th class="text-center">Estoque no Sistema</th>
                    <th style="width: 180px;">Quantidade Contada</th>
                </tr>
            </thead>
            <tbody>
                {% for item in itens_inventario %}
                <tr>
                    <td>{{ item.produto_id }}</td>
                    <td>{{ (item.get('produtos') or {}).get('codigo_sustentare', '') }}</td>
                    <td>{{ (item.get('produtos') or {}).get('codigo_valor', '') }}</td>
                    <td>{{ (item.get('produtos') or {}).get('descricao', 'N/A') }}</td>
                    <td class="text-center fw-bold">{{ item.quantidade_teorica }}</td>
                    <td>
                        <input type="number" step="0.01" class="form-control" name="quantidade_{{ item.id }}" value="{{ item.quantidade_contada if item.quantidade_contada is not none else '' }}">
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="6" class="text-center">Nenhum item para contar neste inventário.</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="text-center mt-4">
        <button type="submit" class="btn btn-primary btn-lg">
            <i class="bi bi-save"></i> Salvar Contagens
        </button>
    </div>
</form>

{% endblock %}